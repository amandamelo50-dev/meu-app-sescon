<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ficha de Inscrição - SESCON-SP / AESCON-SP</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* Estilos Customizados para Cores SESCON/AESCON */
        :root {
            --sescon-red: #cc0000;
            --aescon-gray: #333;
        }
        .header-brand {
            border-bottom: 3px solid var(--sescon-red);
            padding-bottom: 15px;
            margin-bottom: 30px;
        }
        .header-brand img {
            max-width: 250px;
        }
        .btn-primary-sescon {
            background-color: var(--sescon-red);
            border-color: var(--sescon-red);
            transition: background-color 0.3s;
        }
        .btn-primary-sescon:hover {
            background-color: #a00000;
            border-color: #a00000;
        }
        .alert-territorio {
            background-color: #fff3cd;
            color: #856404;
            border-color: #ffeeba;
        }
        .form-section-title {
            color: var(--aescon-gray);
            border-bottom: 1px solid #eee;
            padding-bottom: 5px;
            margin-bottom: 20px;
            font-weight: 600;
        }
    </style>
</head>
<body>

<div class="container my-5">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card p-4 shadow-lg">
                <div class="header-brand text-center">
                    <img src="https://via.placeholder.com/250x50?text=LOGO+SESCON/AESCON" alt="Logos SESCON-SP e AESCON-SP" class="img-fluid">
                    <h1 class="h4 mt-2" style="color: var(--sescon-red);">FICHA DE INSCRIÇÃO PARA ASSOCIAÇÃO</h1>
                </div>

                <form id="associationForm" method="POST" action="processar.php">
                    
                    <h2 class="form-section-title">1. Dados da Empresa</h2>

                    <div class="row">
                        <div class="col-md-7 mb-3">
                            <label for="cnpj" class="form-label">CNPJ <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="cnpj" name="cnpj" maxlength="18" required onblur="lookupCNPJ(this.value)">
                            <div class="form-text text-danger" id="cnpj-error"></div>
                        </div>
                        <div class="col-md-5 mb-3">
                            <label for="crcEmpresa" class="form-label">CRC da Empresa</label>
                            <input type="text" class="form-control" id="crcEmpresa" name="crcEmpresa">
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="razaoSocial" class="form-label">Razão Social</label>
                        <input type="text" class="form-control" id="razaoSocial" name="razaoSocial" readonly required>
                    </div>

                    <div class="row">
                        <div class="col-md-8 mb-3">
                            <label for="endereco" class="form-label">Endereço (Rua/Av.)</label>
                            <input type="text" class="form-control" id="endereco" name="endereco" readonly>
                        </div>
                        <div class="col-md-4 mb-3">
                            <label for="complemento" class="form-label">Número/Complemento</label>
                            <input type="text" class="form-control" id="complemento" name="complemento" readonly>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="segmento" class="form-label">Segmento da Empresa (Ex: Contabilidade, Jurídico) <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="segmento" name="segmento" required>
                    </div>
                    
                    <div id="territorial-alert" class="alert alert-territorio d-none" role="alert">
                        <strong>Atenção:</strong> Sua cidade não é atendida pelo SESCON-SP. Seu pedido será analisado para a **AESCON-SP** (Associação).
                    </div>

                    <h2 class="form-section-title mt-4">2. Dados do Sócio/Responsável</h2>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="nomeSocio" class="form-label">Nome Completo do Sócio <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="nomeSocio" name="nomeSocio" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="cpfSocio" class="form-label">CPF do Sócio <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="cpfSocio" name="cpfSocio" maxlength="14" required>
                        </div>
                    </div>

                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="telefone" class="form-label">Telefone (WhatsApp preferencial) <span class="text-danger">*</span></label>
                            <input type="text" class="form-control" id="telefone" name="telefone" required>
                            <small class="form-text text-muted">A forma de contato preferencial é o WhatsApp.</small>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="email" class="form-label">E-mail <span class="text-danger">*</span></label>
                            <input type="email" class="form-control" id="email" name="email" required>
                        </div>
                    </div>
                    
                    <h2 class="form-section-title mt-4">3. Plano de Associação</h2>

                    <div class="mb-3">
                        <label for="plano" class="form-label">Selecione o Plano Sugerido <span class="text-danger">*</span></label>
                        <select class="form-select" id="plano" name="plano" required onchange="updatePlanDetails(this.value)">
                            <option value="">Selecione um plano</option>
                            <option value="Plano Ouro">Plano Ouro</option>
                            <option value="Plano Ouro Premium">Plano Ouro Premium</option>
                            <option value="Plano Prata">Plano Prata</option>
                        </select>
                        <div class="mt-2 p-2 border rounded" id="plano-details" style="min-height: 50px; background-color: #f8f9fa;">
                            Selecione um plano para ver a descrição.
                        </div>
                    </div>

                    <div class="mb-3">
                        <label class="form-label">Valor Sugerido (Proporcional à Anuidade)</label>
                        <input type="text" class="form-control" id="valorProporcional" name="valorProporcional" value="R$ 0,00" readonly>
                        <div class="form-text text-info">
                            O valor será confirmado pelo nosso sistema com base no mês de preenchimento.
                        </div>
                    </div>

                    <h2 class="form-section-title mt-4">4. Declaração</h2>
                    
                    <div class="form-check mb-3">
                        <input class="form-check-input" type="checkbox" value="aceito" id="deAcordo" name="deAcordo" required>
                        <label class="form-check-label" for="deAcordo">
                            Declaro estar de acordo com as políticas de associação do SESCON-SP/AESCON-SP e solicito a análise.
                            <a href="#" target="_blank"> (Consultar Estatuto e Termos)</a>
                        </label>
                    </div>

                    <button type="submit" class="btn btn-primary-sescon btn-lg w-100">
                        Enviar Ficha de Inscrição
                    </button>
                    
                    <div class="form-text text-center mt-3">
                        <small>Ao enviar, você concorda que o preenchimento dos dados é de sua responsabilidade.</small>
                    </div>

                </form>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
<script>
    // --- LÓGICA DE FRONTEND (JAVASCRIPT) ---
    const cnpjInput = document.getElementById('cnpj');
    
    // 1. MÁSCARA CNPJ
    cnpjInput.addEventListener('input', function (e) {
        let value = e.target.value.replace(/\D/g, ''); 
        value = value.replace(/^(\d{2})(\d)/, '$1.$2'); 
        value = value.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
        value = value.replace(/\.(\d{3})(\d)/, '.$1/$2'); 
        value = value.replace(/(\d{4})(\d)/, '$1-$2'); 
        e.target.value = value.substring(0, 18);
    });

    // 2. MÁSCARA CPF
    document.getElementById('cpfSocio').addEventListener('input', function (e) {
        let value = e.target.value.replace(/\D/g, ''); 
        value = value.replace(/(\d{3})(\d)/, '$1.$2'); 
        value = value.replace(/(\d{3})(\d)/, '$1.$2'); 
        value = value.replace(/(\d{3})(\d{1,2})$/, '$1-$2');
        e.target.value = value.substring(0, 14);
    });
    
    // Função de validação de dígitos (simples no cliente, mas é essencial no BACKEND)
    function validateCNPJ(cnpj) {
        cnpj = cnpj.replace(/[^\d]+/g,'');
        if (cnpj.length !== 14 || /^(\d)\1{13}$/.test(cnpj)) {
            return false;
        }
        return true;
    }

    // 3. SIMULAÇÃO DE CONSULTA CNPJ e Regra de Base Territorial
    function lookupCNPJ(cnpj) {
        const errorDiv = document.getElementById('cnpj-error');
        const alertDiv = document.getElementById('territorial-alert');
        const submitButton = document.querySelector('button[type="submit"]');

        errorDiv.textContent = '';
        alertDiv.classList.add('d-none');
        submitButton.disabled = false; // Habilita por padrão

        document.getElementById('razaoSocial').value = '';
        document.getElementById('endereco').value = '';
        document.getElementById('complemento').value = '';

        if (cnpj.length < 18 || !validateCNPJ(cnpj)) {
            errorDiv.textContent = 'CNPJ Inválido. Por favor, verifique o número.';
            return;
        }

        // SIMULAÇÃO DE DADOS (A SER REALIZADA POR API NO 'processar.php')
        let cidade = '';
        if (cnpj.includes('09043954')) { // Exemplo de CNPJ em São Paulo (Base SESCON-SP)
            document.getElementById('razaoSocial').value = 'BIU CONTA PRO MAX LTDA';
            document.getElementById('endereco').value = 'AV PAULISTA, 1471';
            document.getElementById('complemento').value = 'ANDAR 10';
            cidade = 'SÃO PAULO';
        } else if (cnpj.includes('62636675')) { // Exemplo de CNPJ fora da Base (Base AESCON)
            document.getElementById('razaoSocial').value = 'EMPRESA FORA DA BASE TERRITORIAL';
            document.getElementById('endereco').value = 'RUA X, 123';
            document.getElementById('complemento').value = 'BLOCO A';
            cidade = 'CAMPINAS'; // Base Territorial Restrita
        } else {
            document.getElementById('razaoSocial').value = 'Dados obtidos com sucesso. Confirme os campos.';
        }

        // Lógica de Bloqueio/Alerta Base Territorial
        if (cidade.toUpperCase() === 'CAMPINAS' || cidade.toUpperCase() === 'SANTOS' || cidade.toUpperCase() === 'TUPÃ') {
            alertDiv.classList.remove('d-none');
            submitButton.disabled = true; // Bloqueia o envio no Frontend
            errorDiv.textContent = 'O envio foi bloqueado. Por favor, leia o alerta acima.';
        }
    }
    
    // 4. LÓGICA DE ATUALIZAÇÃO DO PLANO
    function updatePlanDetails(plano) {
        const detailsDiv = document.getElementById('plano-details');
        const valorInput = document.getElementById('valorProporcional');
        let descricao = '';
        let valorBase = 0;

        if (plano === 'Plano Ouro Premium') {
            descricao = 'Inclui associação ao **SESCON** e à **AESCON-SP** + Pagamento de Contribuição Representativa. O plano mais completo.';
            valorBase = 1200.00;
        } else if (plano === 'Plano Ouro') {
            descricao = 'Plano Ouro. Inclui associação ao SESCON-SP e à AESCON-SP. Não inclui Contribuição Representativa.';
            valorBase = 900.00;
        } else if (plano === 'Plano Prata') {
            descricao = 'Plano Prata. Serviços essenciais. Inclui apenas associação ao SESCON-SP.';
            valorBase = 500.00;
        } else {
            descricao = 'Selecione um plano para ver a descrição.';
            valorBase = 0.00;
        }

        // Atualiza a descrição e simula o valor proporcional (A LÓGICA FINAL É NO BACKEND!)
        detailsDiv.innerHTML = descricao;
        const mesAtual = new Date().getMonth() + 1; // 1 (Jan) a 12 (Dez)
        const mesesRestantes = 12 - mesAtual + 1;
        
        // Simulação de cálculo proporcional
        let valorProporcional = 0;
        if (valorBase > 0) {
            valorProporcional = (valorBase / 12) * mesesRestantes;
        }
        
        valorInput.value = `R$ ${valorProporcional.toFixed(2).replace('.', ',')}`;
    }
</script>

</body>
</html>
