<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <title>Ficha de Associa√ß√£o - SESCON-SP</title>
  <style>
    body { 
        font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        background: linear-gradient(135deg, #8B0000 0%, #A52A2A 100%);
        color: #333;
        margin: 0;
        padding: 20px;
        min-height: 100vh;
    }

    .container { 
        max-width: 900px;
        margin: 30px auto;
        background: white;
        padding: 30px;
        border-radius: 15px;
        box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        position: relative;
    }

    .container::before {
        content: '';
        position: absolute;
        top: 0;
        left: 0;
        right: 0;
        height: 5px;
        background: linear-gradient(90deg, #8B0000, #FFD700, #8B0000);
    }

    h1 {
        text-align: center;
        color: #8B0000;
        font-size: 2.2em;
        margin-bottom: 10px;
    }

    h2 {
        color: #8B0000;
        font-size: 1.4em;
        border-left: 4px solid #8B0000;
        padding-left: 10px;
        margin-top: 25px;
    }

    h3 {
        color: #8B0000;
        font-size: 1.2em;
        margin: 15px 0 10px 0;
    }

    label { 
        display: block;
        margin-top: 15px;
        font-weight: 600;
        color: #555;
    }

    input, select, textarea { 
        width: 100%;
        padding: 12px;
        margin-top: 8px;
        box-sizing: border-box;
        border: 2px solid #ddd;
        border-radius: 8px;
        font-size: 14px;
    }

    input:focus, select:focus {
        border-color: #8B0000;
        outline: none;
    }

    button { 
        margin-top: 20px;
        padding: 14px 25px;
        background: linear-gradient(135deg, #8B0000, #A52A2A);
        color: white;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-size: 16px;
        font-weight: 600;
    }

    button:hover {
        background: linear-gradient(135deg, #A52A2A, #8B0000);
    }

    .secondary-btn {
        background: #6c757d !important;
        width: auto !important;
    }

    .secondary-btn:hover {
        background: #5a6268 !important;
    }

    #signature-pad {
        border: 2px dashed #8B0000;
        border-radius: 8px;
        background: #f8f9fa;
        cursor: crosshair;
        width: 100%;
    }

    #downloadLink { 
        display: block;
        margin-top: 20px;
        padding: 15px;
        background: #28a745;
        color: white;
        text-decoration: none;
        border-radius: 8px;
        text-align: center;
        font-weight: 600;
    }

    #result {
        margin-top: 20px;
        padding: 15px;
        border-radius: 8px;
        font-weight: 600;
        text-align: center;
    }

    .lgpd-footer {
        margin-top: 30px;
        padding: 20px;
        background: #f8f9fa;
        border-radius: 8px;
        border-left: 4px solid #8B0000;
        font-size: 12px;
        color: #666;
        line-height: 1.5;
    }

    .socio-option {
        padding: 10px;
        margin: 5px 0;
        border: 2px solid #ddd;
        border-radius: 5px;
        cursor: pointer;
        transition: all 0.3s;
    }

    .socio-option:hover {
        border-color: #8B0000;
        background: #f8f9fa;
    }

    .socio-option.selected {
        border-color: #8B0000;
        background: #e7f1ff;
    }

    .valores-section {
        background: #f8f9fa;
        padding: 15px;
        border-radius: 8px;
        margin: 15px 0;
        border-left: 4px solid #8B0000;
    }

    .servico-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
        gap: 10px;
        margin: 10px 0;
    }

    .servico-option {
        padding: 10px;
        border: 2px solid #ddd;
        border-radius: 5px;
        cursor: pointer;
        text-align: center;
        transition: all 0.3s;
    }

    .servico-option.selected {
        border-color: #8B0000;
        background: #e7f1ff;
    }

    .hidden {
        display: none;
    }

    .success { color: green; background: #e6ffe6; }
    .error { color: red; background: #ffe6e6; }
  </style>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
</head>
<body>
  <div class="container">
    <h1>Ficha de Associa√ß√£o - SESCON-SP</h1>
    <p style="text-align: center; color: #666; margin-bottom: 30px;">
      Preencha os dados abaixo para gerar sua ficha de associa√ß√£o
    </p>

    <form id="fichaForm">
      <h2>üìã Dados da Empresa</h2>
      
      <label for="cnpj">CNPJ *</label>
      <input type="text" name="cnpj" id="cnpj" placeholder="Somente n√∫meros" required maxlength="14">

      <label for="razao">Raz√£o Social *</label>
      <input type="text" name="razao" id="razao" placeholder="Nome completo da empresa" required>

      <label for="email">E-mail *</label>
      <input type="email" name="email" id="email" placeholder="contato@empresa.com" required>

      <label for="telefone">Telefone *</label>
      <input type="text" name="telefone" id="telefone" placeholder="(11) 9XXXX-XXXX" required>

      <label for="endereco">Endere√ßo Completo</label>
      <input type="text" name="endereco" id="endereco" placeholder="Rua, n√∫mero, complemento, cidade">

      <h2>üë• Dados do S√≥cio/Respons√°vel</h2>

      <label for="tipoResponsavel">Quem est√° preenchendo este formul√°rio? *</label>
      <select name="tipo_responsavel" id="tipoResponsavel" required>
        <option value="">Selecione...</option>
        <option value="socio">S√≥cio da empresa</option>
        <option value="outro">Outro respons√°vel</option>
      </select>

      <!-- SE√á√ÉO S√ìCIO -->
      <div id="secaoSocio" class="hidden">
        <h3>Selecione o S√≥cio</h3>
        <div id="listaSocios"></div>
        
        <div style="margin-top: 15px;">
          <label for="nome_socio">Nome do S√≥cio *</label>
          <input type="text" name="nome_socio" id="nome_socio" placeholder="Nome completo do s√≥cio">
        </div>

        <div>
          <label for="cpf_socio">CPF do S√≥cio *</label>
          <input type="text" name="cpf_socio" id="cpf_socio" placeholder="Somente n√∫meros" maxlength="11">
        </div>
      </div>

      <!-- SE√á√ÉO OUTRO RESPONS√ÅVEL -->
      <div id="secaoOutroResponsavel" class="hidden">
        <div>
          <label for="nome_responsavel">Nome do Respons√°vel pelo Preenchimento *</label>
          <input type="text" name="nome_responsavel" id="nome_responsavel" placeholder="Nome completo do respons√°vel">
        </div>

        <div>
          <label for="cpf_responsavel">CPF do Respons√°vel</label>
          <input type="text" name="cpf_responsavel" id="cpf_responsavel" placeholder="Somente n√∫meros" maxlength="11">
        </div>

        <div>
          <label for="nome_socio_representado">Nome do S√≥cio Representado *</label>
          <input type="text" name="nome_socio_representado" id="nome_socio_representado" placeholder="Nome do s√≥cio que est√° sendo representado">
        </div>

        <div>
          <label for="cpf_socio_representado">CPF do S√≥cio Representado *</label>
          <input type="text" name="cpf_socio_representado" id="cpf_socio_representado" placeholder="CPF do s√≥cio representado" maxlength="11">
        </div>
      </div>

      <h2>üíº Servi√ßo de Interesse</h2>
      <label>Qual servi√ßo voc√™ est√° buscando? *</label>
      <div class="servico-grid">
        <div class="servico-option" data-value="institucional">Institucional</div>
        <div class="servico-option" data-value="bolsa_talentos">Bolsa de Talentos</div>
        <div class="servico-option" data-value="convencao_coletiva">Conven√ß√£o Coletiva</div>
        <div class="servico-option" data-value="cursos">Cursos UniSESCON</div>
        <div class="servico-option" data-value="consultoria_juridica">Consultoria Jur√≠dica</div>
        <div class="servico-option" data-value="central_servicos">Central de Servi√ßos</div>
        <div class="servico-option" data-value="certificado_digital">Certificado Digital</div>
        <div class="servico-option" data-value="contabil_store">Contabil Store</div>
        <div class="servico-option" data-value="pesquisas">Pesquisas</div>
        <div class="servico-option" data-value="societario_legal">Societ√°rio e Legal</div>
        <div class="servico-option" data-value="lgpd">Projeto LGPD</div>
        <div class="servico-option" data-value="pqec">PQEC</div>
        <div class="servico-option" data-value="eventos">Eventos</div>
        <div class="servico-option" data-value="auditorio">Loca√ß√£o de Audit√≥rio</div>
        <div class="servico-option" data-value="parcerias">Parcerias</div>
        <div class="servico-option" data-value="coworking">Coworking/Endere√ßo Fiscal</div>
      </div>
      <input type="hidden" name="servico" id="servicoSelecionado">

      <h2>üìä Plano de Associa√ß√£o</h2>
      <div id="planoSugeridoSection">
        <label for="planoSugerido">Plano Sugerido (baseado na atividade e regi√£o) *</label>
        <input type="text" name="plano_sugerido" id="planoSugerido" readonly 
               style="background: #f0f0f0;"
               placeholder="O plano ser√° sugerido automaticamente ap√≥s consulta do CNPJ"
               required>
        <div id="valoresSection" class="valores-section hidden"></div>
      </div>

      <h2>üí≥ Forma de Pagamento</h2>
      <div id="formaPagamentoSection" class="hidden">
        <label>Selecione a forma de pagamento *</label>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
          <div class="servico-option" data-value="avista">√Ä Vista</div>
          <div class="servico-option" data-value="parcelado">Parcelado</div>
        </div>
        <input type="hidden" name="forma_pagamento" id="formaPagamentoSelecionada">
      </div>

      <h2>‚úçÔ∏è Assinatura</h2>
      
      <label for="signature-pad">Assinatura do S√≥cio/Respons√°vel (use mouse ou toque) *</label>
      <canvas id="signature-pad" width="600" height="200"></canvas>
      <div style="text-align: center; margin-top: 10px;">
        <button type="button" id="clearBtn" class="secondary-btn">Limpar Assinatura</button>
      </div>

      <label style="margin-top: 20px;">
        <input type="checkbox" name="termo_aceite" value="1" required> 
        Declaro estar ciente e de acordo com os termos de associa√ß√£o. *
      </label>

      <button type="submit" id="sendBtn">Gerar PDF da Ficha</button>
    </form>

    <div id="result"></div>
    <a id="downloadLink" style="display:none">üì• Baixar PDF Gerado</a>

    <!-- FOOTER LGPD -->
    <div class="lgpd-footer">
      <strong>O Sescon-SP informa que, em respeito aos preceitos elencados no art. 6¬∫ da LGPD e, em especial, ao Princ√≠pio da Finalidade, a coleta dos dados pessoais dispostos neste formul√°rio, ser√° pautada na hip√≥tese de tratamento prevista no inciso IX do Art. 7¬∫ da Lei n¬∫ 13.709/18.</strong><br><br>
      Saiba mais: <a href="https://sescon.org.br/wp-content/uploads/2025/05/POLITICA-DE-PRIVACIDADE-E-COOKIES-1.pdf" target="_blank">Pol√≠tica de Privacidade e Cookies</a>
    </div>
  </div>

  <script>
    // ========== CONFIGURA√á√ÉO DA ASSINATURA ==========
    const canvas = document.getElementById("signature-pad");
    const ctx = canvas.getContext("2d");
    let drawing = false;
    let lastX = 0, lastY = 0;

    // Configurar fundo branco para o canvas
    ctx.fillStyle = 'white';
    ctx.fillRect(0, 0, canvas.width, canvas.height);
    ctx.strokeStyle = "#8B0000";
    ctx.lineWidth = 2;
    ctx.lineCap = "round";

    function drawLine(x1, y1, x2, y2) {
        ctx.beginPath();
        ctx.moveTo(x1, y1);
        ctx.lineTo(x2, y2);
        ctx.stroke();
    }

    canvas.addEventListener("mousedown", (e) => {
        drawing = true;
        const rect = canvas.getBoundingClientRect();
        lastX = e.clientX - rect.left;
        lastY = e.clientY - rect.top;
    });

    canvas.addEventListener("mousemove", (e) => {
        if (!drawing) return;
        const rect = canvas.getBoundingClientRect();
        const x = e.clientX - rect.left;
        const y = e.clientY - rect.top;
        drawLine(lastX, lastY, x, y);
        lastX = x;
        lastY = y;
    });

    canvas.addEventListener("mouseup", () => drawing = false);
    canvas.addEventListener("mouseout", () => drawing = false);

    document.getElementById("clearBtn").addEventListener("click", () => {
        ctx.fillStyle = 'white';
        ctx.fillRect(0, 0, canvas.width, canvas.height);
        ctx.strokeStyle = "#8B0000";
    });

    // ========== SELE√á√ÉO DE SERVI√áO ==========
    document.querySelectorAll('.servico-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('.servico-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            this.classList.add('selected');
            document.getElementById('servicoSelecionado').value = this.getAttribute('data-value');
        });
    });

    // ========== SELE√á√ÉO DE FORMA DE PAGAMENTO ==========
    document.querySelectorAll('#formaPagamentoSection .servico-option').forEach(option => {
        option.addEventListener('click', function() {
            document.querySelectorAll('#formaPagamentoSection .servico-option').forEach(opt => {
                opt.classList.remove('selected');
            });
            this.classList.add('selected');
            document.getElementById('formaPagamentoSelecionada').value = this.getAttribute('data-value');
        });
    });

    // ========== ALTERA√á√ÉO ENTRE S√ìCIO E OUTRO RESPONS√ÅVEL ==========
    document.getElementById('tipoResponsavel').addEventListener('change', function() {
        const secaoSocio = document.getElementById('secaoSocio');
        const secaoOutro = document.getElementById('secaoOutroResponsavel');
        
        if (this.value === 'socio') {
            secaoSocio.classList.remove('hidden');
            secaoOutro.classList.add('hidden');
        } else if (this.value === 'outro') {
            secaoSocio.classList.add('hidden');
            secaoOutro.classList.remove('hidden');
        } else {
            secaoSocio.classList.add('hidden');
            secaoOutro.classList.add('hidden');
        }
    });

    // ========== CONSULTA AUTOM√ÅTICA DE CNPJ ==========
    async function consultarCNPJ(cnpj) {
        try {
            const response = await fetch(`https://meu-app-sescon.onrender.com/consultar-cnpj/${cnpj}`);
            
            if (response.ok) {
                const dados = await response.json();
                
                if (dados.razao_social) {
                    document.querySelector('input[name="razao"]').value = dados.razao_social;
                }
                if (dados.endereco) {
                    document.querySelector('input[name="endereco"]').value = dados.endereco;
                }
                
                if (dados.socios && dados.socios.length > 0) {
                    preencherListaSocios(dados.socios);
                }
                
                await sugerirPlano(cnpj);
                mostrarMensagem('‚úÖ Dados preenchidos automaticamente!', 'success');
                
            } else {
                mostrarMensagem('‚ö†Ô∏è CNPJ n√£o encontrado. Preencha manualmente.', 'warning');
            }
        } catch (error) {
            mostrarMensagem('‚ùå Erro de conex√£o. Verifique a internet.', 'error');
        }
    }

    // ========== PREENCHER LISTA DE S√ìCIOS ==========
    function preencherListaSocios(socios) {
        const listaSocios = document.getElementById('listaSocios');
        listaSocios.innerHTML = '';
        
        socios.forEach((socio, index) => {
            const socioDiv = document.createElement('div');
            socioDiv.className = 'socio-option';
            socioDiv.innerHTML = `
                <strong>${socio.nome || 'S√≥cio ' + (index + 1)}</strong>
                ${socio.qualificacao ? `<br><small>${socio.qualificacao}</small>` : ''}
            `;
            
            socioDiv.addEventListener('click', function() {
                document.querySelectorAll('.socio-option').forEach(opt => {
                    opt.classList.remove('selected');
                });
                this.classList.add('selected');
                document.querySelector('input[name="nome_socio"]').value = socio.nome || '';
                document.querySelector('input[name="cpf_socio"]').value = socio.cpf || '';
            });
            
            listaSocios.appendChild(socioDiv);
        });
    }

    // ========== SUGERIR PLANO ==========
    async function sugerirPlano(cnpj) {
        try {
            const response = await fetch(`https://meu-app-sescon.onrender.com/sugerir-plano/${cnpj}`);
            
            if (response.ok) {
                const dados = await response.json();
                
                if (dados.plano && !dados.error) {
                    document.getElementById('planoSugerido').value = dados.plano;
                    await calcularValores(dados.plano);
                    document.getElementById('formaPagamentoSection').classList.remove('hidden');
                }
            }
        } catch (error) {
            console.error('Erro ao sugerir plano:', error);
        }
    }

    // ========== CALCULAR VALORES ==========
    async function calcularValores(plano) {
        try {
            const response = await fetch(`https://meu-app-sescon.onrender.com/calcular-valores/${plano}`);
            
            if (response.ok) {
                const valores = await response.json();
                
                const valoresSection = document.getElementById('valoresSection');
                valoresSection.innerHTML = `
                    <h3>üí≥ Valores do ${plano}</h3>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div>
                            <strong>√Ä Vista:</strong><br>
                            <span style="font-size: 1.2em; color: #28a745; font-weight: bold;">${valores.a_vista}</span>
                        </div>
                        <div>
                            <strong>Parcelado:</strong><br>
                            <span style="font-size: 1.1em; color: #007bff;">${valores.parcelado}</span>
                        </div>
                    </div>
                    <div style="margin-top: 10px; font-size: 0.9em; color: #666;">
                        üí° Valores proporcionais referentes ao m√™s atual
                    </div>
                `;
                valoresSection.classList.remove('hidden');
            }
        } catch (error) {
            console.error('Erro ao calcular valores:', error);
        }
    }

    // ========== FUN√á√ÉO PARA MENSAGENS ==========
    function mostrarMensagem(mensagem, tipo = 'info') {
        const mensagemAnterior = document.getElementById('mensagem-flutuante');
        if (mensagemAnterior) mensagemAnterior.remove();
        
        const cores = {
            'success': '#28a745', 'warning': '#ffc107', 'error': '#dc3545', 'info': '#17a2b8'
        };
        
        const mensagemDiv = document.createElement('div');
        mensagemDiv.id = 'mensagem-flutuante';
        mensagemDiv.style.cssText = `
            position: fixed; top: 20px; right: 20px; background: ${cores[tipo]};
            color: white; padding: 12px 18px; border-radius: 5px; z-index: 1000;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1); font-weight: 600;
        `;
        mensagemDiv.textContent = mensagem;
        document.body.appendChild(mensagemDiv);
        
        setTimeout(() => mensagemDiv.remove(), 4000);
    }

    // ========== EVENTOS PRINCIPAIS ==========
    document.querySelector('input[name="cnpj"]').addEventListener('blur', function() {
        const cnpj = this.value.replace(/\D/g, '');
        if (cnpj.length === 14) consultarCNPJ(cnpj);
    });

    document.querySelectorAll('input[type="text"]').forEach(input => {
        if (input.name.includes('cnpj') || input.name.includes('cpf')) {
            input.addEventListener('input', function() {
                this.value = this.value.replace(/\D/g, '');
            });
        }
    });

    // ========== ENVIO DO FORMUL√ÅRIO CORRIGIDO ==========
    document.getElementById("fichaForm").addEventListener("submit", async (ev) => {
        ev.preventDefault();
        console.log("üìç Iniciando envio do formul√°rio...");
        
        const form = ev.target;
        const sendBtn = document.getElementById("sendBtn");
        const resultDiv = document.getElementById("result");

        // VALIDA√á√ÉO MANUAL (CORRIGIDA)
        let isValid = true;
        const errors = [];

        // Campos b√°sicos obrigat√≥rios
        if (!form.cnpj.value.trim()) errors.push('CNPJ √© obrigat√≥rio');
        if (!form.razao.value.trim()) errors.push('Raz√£o Social √© obrigat√≥ria');
        if (!form.email.value.trim()) errors.push('E-mail √© obrigat√≥rio');
        if (!form.telefone.value.trim()) errors.push('Telefone √© obrigat√≥rio');
        if (!form.tipo_responsavel.value) errors.push('Selecione quem est√° preenchendo');

        // Valida√ß√£o por tipo de respons√°vel
        const tipoResponsavel = form.tipo_responsavel.value;
        if (tipoResponsavel === 'socio') {
            if (!form.nome_socio.value.trim()) errors.push('Nome do s√≥cio √© obrigat√≥rio');
            if (!form.cpf_socio.value.trim()) errors.push('CPF do s√≥cio √© obrigat√≥rio');
        } else if (tipoResponsavel === 'outro') {
            if (!form.nome_socio_representado.value.trim()) errors.push('Nome do s√≥cio representado √© obrigat√≥rio');
            if (!form.cpf_socio_representado.value.trim()) errors.push('CPF do s√≥cio representado √© obrigat√≥rio');
            if (!form.nome_responsavel.value.trim()) errors.push('Nome do respons√°vel √© obrigat√≥rio');
        }

        // Outras valida√ß√µes
        if (!document.getElementById('servicoSelecionado').value) errors.push('Selecione um servi√ßo');
        if (!document.getElementById('formaPagamentoSelecionada').value) errors.push('Selecione a forma de pagamento');
        if (!document.getElementById('planoSugerido').value) errors.push('Plano n√£o foi sugerido - verifique o CNPJ');

        // VALIDA√á√ÉO CORRIGIDA DA ASSINATURA
        const imageData = ctx.getImageData(0, 0, canvas.width, canvas.height).data;
        let hasSignature = false;

        for (let i = 0; i < imageData.length; i += 4) {
            if (imageData[i] < 255 || imageData[i + 1] < 255 || imageData[i + 2] < 255) {
                hasSignature = true;
                break;
            }
        }

        if (!hasSignature) {
            errors.push('Fa√ßa sua assinatura no campo indicado');
        }

        if (errors.length > 0) {
            resultDiv.innerHTML = `<div class="error">‚ùå ${errors.join('<br>‚ùå ')}</div>`;
            mostrarMensagem('‚ùå Corrija os erros acima', 'error');
            return;
        }

        // PREPARAR DADOS
        sendBtn.textContent = "Gerando PDF...";
        sendBtn.disabled = true;
        resultDiv.innerHTML = `<div>‚è≥ Gerando sua ficha de associa√ß√£o...</div>`;

        const json = {
            cnpj: form.cnpj.value.replace(/\D/g, ''),
            razao: form.razao.value,
            email: form.email.value,
            telefone: form.telefone.value,
            endereco: form.endereco.value,
            servico: document.getElementById('servicoSelecionado').value,
            plano: document.getElementById('planoSugerido').value,
            forma_pagamento: document.getElementById('formaPagamentoSelecionada').value,
            termo_aceite: true,
            signature: canvas.toDataURL()
        };

        // Dados do respons√°vel
        if (tipoResponsavel === 'socio') {
            json.nome_socio = form.nome_socio.value;
            json.cpf_socio = form.cpf_socio.value.replace(/\D/g, '');
            json.tipo_resp = 'S√≥cio';
        } else {
            json.nome_socio = form.nome_socio_representado.value;
            json.cpf_socio = form.cpf_socio_representado.value.replace(/\D/g, '');
            json.nome_outro = form.nome_responsavel.value;
            json.contato_outro = form.cpf_responsavel.value.replace(/\D/g, '');
            json.tipo_resp = 'Outro Respons√°vel';
        }

        console.log("Dados enviados:", json);

        // ENVIAR PARA O BACKEND
        try {
            const resp = await fetch("https://meu-app-sescon.onrender.com/gerar-pdf", {
                method: "POST",
                headers: {"Content-Type": "application/json"},
                body: JSON.stringify(json)
            });

            if (resp.ok) {
                const blob = await resp.blob();
                const url = URL.createObjectURL(blob);
                const link = document.getElementById("downloadLink");
                link.href = url;
                link.download = `ficha_sescon_${json.razao.replace(/\s+/g, '_')}.pdf`;
                link.style.display = "block";
                
                resultDiv.innerHTML = `<div class="success">‚úÖ PDF gerado com sucesso! <a href="${url}" download style="color: #0066cc; text-decoration: underline;">üì• Clique aqui para baixar</a></div>`;
                mostrarMensagem('‚úÖ Ficha gerada com sucesso!', 'success');
                
            } else {
                const errorText = await resp.text();
                resultDiv.innerHTML = `<div class="error">‚ùå Erro ao gerar PDF: ${errorText}</div>`;
                mostrarMensagem('‚ùå Erro ao gerar PDF', 'error');
            }
        } catch (error) {
            resultDiv.innerHTML = `<div class="error">‚ùå Erro de conex√£o: ${error.message}</div>`;
            mostrarMensagem('‚ùå Erro de conex√£o', 'error');
        } finally {
            sendBtn.textContent = "Gerar PDF da Ficha";
            sendBtn.disabled = false;
        }
    });
  </script>
</body>
</html>
